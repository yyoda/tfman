name: ManualOps

on:
  workflow_dispatch:
    inputs:
      targets:
        description: 'Target directories to apply (space-separated paths, e.g., account/dev account/prod)'
        required: true
        type: string
      command:
        description: 'Terraform command to execute'
        required: true
        type: choice
        options:
          - plan
          - apply
        default: apply

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

permissions:
  id-token: write
  contents: read

env:
  TF_PLUGIN_CACHE_DIR: ${{ github.workspace }}/.terraform.d/plugin-cache

jobs:
  call:
    uses: ./.github/workflows/reusable-manual-ops.yml
    with:
      targets: ${{ inputs.targets }}
      command: ${{ inputs.command }}
    secrets: inherit
